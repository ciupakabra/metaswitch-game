var tutorial,tutorialConfig={preload:preload,create:create,update:update};function preload(){slickUI.load("assets/ui/kenney/kenney.json")}function create(){game.input.keyboard.addKey(Phaser.Keyboard.ESC).onDown.add(function(){tutorialOn=!1,game.state.start("menu")},this),graphicsManager=new GraphicsManager,worldGenerator=new WorldGenerator,gameGroup=game.add.group(),cables=game.add.group(),packets=game.add.group(),nodes=game.add.group(),ui=game.add.group(),arrow=game.add.group(),game.arrow=game.add.group(arrow),game.arrowSprite=game.arrow.create(450,300,"arrow"),game.arrowSprite.anchor.setTo(.5),arrow.add(game.arrowSprite),game.arrowSprite.visible=!1,game.tutorialPanel=new TutorialPanel,game.network=new Network,graphicsManager.network=game.network,paused=!1,timers=[]}function changeTutorialStep(){if(1==tutorialScreen){game.types=[];for(var e=0;e<RESOURCE_COLORS.length;++e)game.types.push(new ResourceUnit(e,10+Math.max(2*Math.ceil((e-2)/2),0),40,RESOURCE_COLORS[e]));for(var t=worldGenerator.generateCityDistribution(game.types);t[0].prob<.3;)t=worldGenerator.generateCityDistribution(game.types);game.newCity=new City(game.network,200,300,1,t),game.newServer=new Server(game.network,450,300,1/0,5,1),game.network.add_node(game.newServer);new Resource(game.network,700,260,game.types[5]);new Resource(game.network,740,300,game.types[2]),new Resource(game.network,700,300,game.types[1]),new Resource(game.network,720,340,game.types[4]),new Resource(game.network,680,340,game.types[3]),game.newResource=new Resource(game.network,660,300,game.types[0]),game.tutorialPanel.updatePanel(55,40,"This is a city. The arcs around it represent the proportion of packet types it sends out."),game.arrowSprite.visible=!0,arrowPosition(game.arrowSprite,200,220,Math.PI/2)}else if(2==tutorialScreen)game.tutorialPanel.updatePanel(305,40,"This is a server. The server connects to the cities and resources, and sends packets to where they need to go."),arrowPosition(game.arrowSprite,450,220,Math.PI/2);else if(3==tutorialScreen)game.tutorialPanel.updatePanel(305,40,"You can buy a server by clicking on an empty space. A button will appear for you to confirm if you want to buy a server.");else if(4==tutorialScreen)game.tutorialPanel.updatePanel(555,40,"These are resources. The different colours represent different types of resource."),arrowPosition(game.arrowSprite,700,220,Math.PI/2);else if(5==tutorialScreen){var a=new Cable(game.network,game.newCity,game.newServer,1,50,1);game.network.add_cable(a);a=new Cable(game.network,game.newServer,game.newResource,1,50,1);game.network.add_cable(a),game.tutorialPanel.updatePanel(205,80,"This is a cable. Packets travel along these cables to get to the resource they need and then travel back to the city."),arrowPosition(game.arrowSprite,350,260,Math.PI/2),game.newCity.create_request=function(){var e=game.types[0],t=new Packet(this,e,null,e.timeout);this.network.add_packet(t);var a=game.network.get_nearest_resource(this,e);game.network.get_cable(this,a).send_packet(this,t),new MyTimer(1500,this.create_request,this)},game.newCity.create_request()}else if(6==tutorialScreen)game.tutorialPanel.updatePanel(205,80,'Cables can be bought by clicking on a node, choosing "Buy/Add Server" and then selecting the place you want to connect.');else if(7==tutorialScreen)game.tutorialPanel.updatePanel(205,80,"The colour of packets represent the resource they need. Unfulfilled packets are slightly darker and have a black dot in the middle."),game.arrowSprite.visible=!1;else if(8==tutorialScreen)game.statusPanel=new StatusPanel(PANEL_MARGIN,PANEL_MARGIN,STATUS_PANEL_WIDTH,STATUS_PANEL_HEIGHT),game.arrowSprite.visible=!0,arrowPosition(game.arrowSprite,231,59,Math.PI),game.tutorialPanel.updatePanel(258,8,"This is your status. It tells you the amount of credit you have, your score, and your total amount of time spent unpaused.");else if(9==tutorialScreen)game.tutorialPanel.updatePanel(258,8,"You start with 2000 credits, and it increases every time you fulfil a request.");else if(10==tutorialScreen){var r=game.add.button(game.width-40,8,"buttonPause",function(){},this,1,0,1,0);r.onInputDown.add(function(){pause(),game.buttonPress=!0,r.visible=!1,n.visible=!0},this);var n=game.add.button(game.width-40,8,"buttonPause",function(){},this,3,2,3,2);game.buttonPlay=n,game.buttonPause=r,r.visible=!1,pause(),n.onInputDown.add(function(){pause(),game.buttonPress=!0,r.visible=!0,n.visible=!1},this);var o=game.add.button(game.width-40,86,"buttonReload",function(){},this,1,0,1,0);buttonSpeed1=game.add.button(game.width-40,47,"buttonSpeed",function(){},this,1,0,1,0),buttonSpeed1.onInputDown.add(function(){changeSpeed(2),game.buttonPress=!0,buttonSpeed1.visible=!1,buttonSpeed2.visible=!0}),buttonSpeed2=game.add.button(game.width-40,47,"buttonSpeed",function(){},this,3,2,3,2),buttonSpeed2.onInputDown.add(function(){changeSpeed(4),game.buttonPress=!0,buttonSpeed2.visible=!1,buttonSpeed4.visible=!0}),buttonSpeed2.visible=!1,buttonSpeed4=game.add.button(game.width-40,47,"buttonSpeed",function(){},this,5,4,5,4),buttonSpeed4.onInputDown.add(function(){changeSpeed(1),game.buttonPress=!0,buttonSpeed4.visible=!1,buttonSpeed1.visible=!0}),buttonSpeed4.visible=!1,o.onInputDown.add(function(){}),game.buttonSpeed=buttonSpeed1,game.buttonSpeed2=buttonSpeed2,game.buttonSpeed4=buttonSpeed4,game.tutorialPanel.updatePanel(520,8,"These are the pause, speed and restart buttons. Pausing the game allows you to build a network without time pressure"),arrowPosition(game.arrowSprite,835,50,0)}else if(11==tutorialScreen)game.tutorialPanel.updatePanel(520,8,"The game will start paused to allow you to build an initial network.");else if(12==tutorialScreen){paused&&(pause(),game.buttonPlay.visible=!1,game.buttonPause.visible=!0),changeSpeed(1),game.buttonSpeed.visible=!0,game.buttonSpeed2.visible=!1,game.buttonSpeed4.visible=!1,game.buttonPause.onInputDown.removeAll(),game.buttonSpeed.onInputDown.removeAll(),graphicsManager.satisfactionBarInit(),arrowPosition(game.arrowSprite,350,260,Math.PI/2),game.types[0]=new ResourceUnit(0,10+Math.max(2*Math.ceil(-1),0),3,RESOURCE_COLORS[0]),game.newResource=new Resource(game.network,660,300,game.types[0]);a=new Cable(game.network,game.newServer,game.newResource,1,50,1);game.network.add_cable(a),game.newCity.create_request=function(){var e=game.types[0],t=new Packet(this,e,null,e.timeout);this.network.add_packet(t);var a=game.network.get_nearest_resource(this,e);game.network.get_cable(this,a).send_packet(this,t),new MyTimer(1500,this.create_request,this)},game.tutorialPanel.updatePanel(210,80,"After a certain amount of time an unfulfilled packet will die. This will be represented by a black circle.")}else if(13==tutorialScreen)game.tutorialPanel.updatePanel(210,80,"Any dead packets will be removed before they are sent down another cable.");else if(14==tutorialScreen)game.tutorialPanel.updatePanel(210,80,"This is the penalty bar. Every time a packet dies its colour will be added to this. The game ends when this is filled."),arrowPosition(game.arrowSprite,350,60,-Math.PI/2);else if(15==tutorialScreen){game.types[0]=new ResourceUnit(0,10+Math.max(2*Math.ceil(-1),0),1/0,RESOURCE_COLORS[0]),game.newResource=new Resource(game.network,660,300,game.types[0]);a=new Cable(game.network,game.newServer,game.newResource,1,50,1);game.network.add_cable(a),game.newCity.create_request=function(){var e=game.types[0],t=new Packet(this,e,null,e.timeout);this.network.add_packet(t);var a=game.network.get_nearest_resource(this,e);game.network.get_cable(this,a).send_packet(this,t),game.time.events.add(300,this.create_request,this)},arrowPosition(game.arrowSprite,239,332,-Math.PI/2),game.tutorialPanel.updatePanel(99,352,"The inner bar is how full a node is. When a node is full, the reward of all packets sent from that node will be decreased.")}else 16==tutorialScreen?(game.tutorialPanel.updatePanel(305,400,"Too many packets in nodes can be solved by upgrading servers or cables."),game.arrowSprite.visible=!1):17==tutorialScreen?game.tutorialPanel.updatePanel(305,400,'Reselecting a cable gives the option of upgrading it; clicking on a server gives an "Upgrade Server" button.'):18==tutorialScreen?game.tutorialPanel.updatePanel(305,400,"Upgrading a server gives it a greater capacity and allows more nodes to be connected to it."):19==tutorialScreen?game.tutorialPanel.updatePanel(305,400,"Upgrading a cable allows more packets to be sent in a given time and packets will also travel down the cable faster."):20==tutorialScreen?game.tutorialPanel.updatePanel(305,400,"The level of a cable is given by its colour and the details of a server are given when it is clicked."):21==tutorialScreen?(game.tutorialPanel.updatePanel(305,400,"That concludes the tutorial. Press the button below to return to the main menu."),game.tutorialPanel.nextButtonText.value="Return to Menu",game.tutorialPanel.nextButtonText.center()):(tutorialOn=!1,game.state.start("menu"))}function update(){tutorialScreen<8&&(totalTime+=game.time.elapsedMS*speed,timers.forEach(function(e){e.expired?timers.splice(timers.indexOf(e),1):e.check()})),tutorialScreen>=8&&(game.statusPanel.updateCredit(currentCredit),paused||(totalTime+=game.time.elapsedMS*speed,timers.forEach(function(e){e.expired?timers.splice(timers.indexOf(e),1):e.check()})))}function arrowPosition(e,t,a,r){e.x=t,e.y=a,e.rotation=r}