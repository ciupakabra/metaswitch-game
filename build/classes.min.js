class Node{constructor(e,t,i,n){this.network=e,this.x=t,this.y=i,this.cables=[],e.add_node(this),this.type=n}connect_with(e){}dist(e){return Math.sqrt((this.sprite.x-e.sprite.x)**2+(this.sprite.y-e.sprite.y)**2)}}class Panel{constructor(e,t,i,n,s){this.panel=new SlickUI.Element.Panel(e,t,i,n),this.header=new SlickUI.Element.Text(0,0,s,20,"#ffffff"),slickUI.add(this.panel),this.panel.add(this.header).centerHorizontally().alpha=.8}setHeader(e){this.header.value=e,this.header.centerHorizontally()}moveTo(e,t){this.panel.x=e,this.panel.y=t}get visible(){return this.panel.visible}set visible(e){this.panel.visible=e}}class GraphicsManager{constructor(){}satisfactionBarInit(){this.satBarGraphics=game.make.graphics(),this.satBarWidth=game.width-(3*PANEL_MARGIN+STATUS_PANEL_WIDTH)-4-37;var e=game.add.graphics(2*PANEL_MARGIN+STATUS_PANEL_WIDTH+2,PANEL_MARGIN+2);ui.add(e),e.alpha=.4,e.beginFill(7105644),e.lineStyle(3,5000268,1),e.drawRect(-1,-1,this.satBarWidth+2,32)}spriteInitServer(e){e.graphicsGroup=game.add.group(nodes),e.graphics=game.add.graphics(e.x,e.y),nodes.add(e.graphics),e.sprite=e.graphicsGroup.create(e.x,e.y,"server"),e.sprite.anchor.set(.5,.5),e.sprite.inputEnabled=!0,e.sprite.node=e,this.createSillhouette(e),e.clicked=!1,e.sprite.events.onInputOver.add(mouseOverListener),e.sprite.events.onInputOut.add(mouseOutListener),tutorialOn||e.sprite.events.onInputDown.add(mouseClickListener)}spriteInitResource(e){e.graphicsGroup=game.add.group(nodes),e.graphics=game.add.graphics(e.x,e.y),e.graphicsGroup.add(e.graphics),e.sprite=e.graphicsGroup.create(e.x,e.y,"resource"),e.sprite.tint=e.color,e.sprite.anchor.set(.5,.5),e.sprite.inputEnabled=!0,e.sprite.node=e,this.createSillhouette(e),e.clicked=!1,e.sprite.events.onInputOver.add(mouseOverListener),e.sprite.events.onInputOut.add(mouseOutListener),tutorialOn||e.sprite.events.onInputDown.add(mouseClickListener)}spriteInitCity(e){e.graphicsGroup=game.add.group(nodes),e.graphics=game.add.graphics(e.x,e.y),e.graphicsGroup.add(e.graphics),e.sprite=e.graphicsGroup.create(e.x,e.y,"city"),e.sprite.anchor.set(.5,.5),e.sprite.inputEnabled=!0,e.sprite.node=e,this.createSillhouette(e),e.clicked=!1;for(var t=game.add.graphics(e.x,e.y),i=0,n=0;n<e.p.length;++n)if(e.p[n].prob>0){t.lineStyle(6,e.p[n].resource_unit.color);var s=game.math.degToRad(360*i+5),r=game.math.degToRad(360*(i+e.p[n].prob)-5);t.arc(0,0,50,s,r,!1),i+=e.p[n].prob}game.add.tween(t).to({rotation:2*Math.PI},2e4,"Linear",!0,0,-1),game.add.tween(t.scale).to({x:1.1,y:1.1},5e3,Phaser.Easing.Cubic.InOut,!0,0,-1,!0),e.graphicsGroup.add(t),e.sprite.events.onInputOver.add(mouseOverListener),e.sprite.events.onInputOut.add(mouseOutListener),tutorialOn||e.sprite.events.onInputDown.add(mouseClickListener)}arcUpdate(e){if(tutorialOn&&15!=tutorialScreen)return e.graphics.destroy(),!1;var t=e.capacity,i=Math.min(360*this.network.packetsInNode(e)/t,359.99);e.graphicsGroup.remove(e.graphics),e.graphics.destroy(),e.graphics=game.add.graphics(e.x,e.y),e.graphicsGroup.add(e.graphics);var n="0"+Math.ceil(255*i/360).toString(16),s="0"+Math.ceil(255*(360-i)/360).toString(16);e.graphics.lineStyle(6,"0x"+n.slice(-2)+s.slice(-2)+"00"),e.graphics.arc(0,0,40,0,game.math.degToRad(360-i),!0)}spriteInitCable(e){e.graphics=game.make.graphics(),e.graphics.lineStyle(2,16777215),e.graphics.moveTo(e.node_1.x,e.node_1.y),e.graphics.lineTo(e.node_2.x,e.node_2.y),e.graphics.endFill(),e.graphics.tint=CABLE_COLORS[0],e.graphics.inputEnabled=!0,e.graphics.events.onInputOver.add(function(){this.alpha=.5},e.graphics),e.graphics.events.onInputOut.add(function(){this.alpha=1},e.graphics),cables.add(e.graphics),game.world.bringToTop(e.node_1.graphicsGroup),game.world.bringToTop(e.node_2.graphicsGroup)}spriteInitPacket(e,t,i,n){e.sprite=game.make.graphics(i.x,i.y),e.sprite.anchor.set(.5,.5),null!=e.content?e.color=e.content.color:e.color=e.destination.color,e.sprite.beginFill(e.color),e.sprite.lineStyle(2),e.sprite.drawCircle(0,0,15),null==e.content&&(e.sprite.beginFill(0),e.sprite.drawCircle(0,0,2),e.sprite.tint=11119017),e.state||this.deadPacket(e),packets.add(e.sprite);var s=Phaser.Timer.SECOND*t.total_time(),r=game.add.tween(e.sprite).to({x:n.x,y:n.y},s,Phaser.Easing.Linear.NONE,!0);e.sprite.tween=r,r.onComplete.add(function(){this.travelling=!1,this.sprite.destroy()},e,1),this.arcUpdate(i),r.onComplete.add(function(e,t,i,n){i.process_packet(n),this.arcUpdate(i)},this,0,n,e),r.timeScale=speed}deadPacket(e){e.sprite.beginFill(0),e.sprite.drawCircle(0,0,8)}satisfactionBarUpdate(){this.satBarGraphics.destroy(),this.satBarGraphics=game.add.graphics(2*PANEL_MARGIN+STATUS_PANEL_WIDTH+2,PANEL_MARGIN+2),this.satBarGraphics.lineStyle(3,5000268,1),this.satBarGraphics.drawRect(-1,-1,this.satBarWidth+2,32);var e=0;for(i=0;i<deadPackets.length;i++)deadPackets[i]>0&&(this.satBarGraphics.alpha=.6,this.satBarGraphics.beginFill(RESOURCE_COLORS[i]),this.satBarGraphics.lineStyle(0,0,1),this.satBarGraphics.drawRect(e/maxPenalty*this.satBarWidth,0,deadPackets[i]/maxPenalty*this.satBarWidth,30),this.satBarGraphics.endFill(),e+=deadPackets[i])}createSillhouette(e){var t=game.make.bitmapData();t.load(e.sprite.key),t.processPixelRGB(function(e){return e.r=255,e.g=255,e.b=255,e}),e.sillhouette=e.graphicsGroup.create(e.x,e.y,t),e.sillhouette.scale.set(1.05),e.sillhouette.anchor.set(.5,.5),e.sillhouette.tint=16775856,e.sillhouette.visible=!1,e.graphicsGroup.bringToTop(e.sprite)}newCityTextInit(){this.newCityText1=game.add.text(2*PANEL_MARGIN+STATUS_PANEL_WIDTH+2,PANEL_MARGIN+4+32,"A New City Appears!"),this.newCityText1.font="Lato",this.newCityText1.fontSize=60,this.newCityText1.stroke="#404040",this.newCityText1.strokeThickness=4,this.newCityText1.fill="#505050",this.newCityText1.alpha=0,this.timer=game.time.create(!1),foreverTimers.push(this.timer),this.timer.start(),ui.add(this.newCityText1)}newCityText(){var e;e=this.timer.loop(50,function(t){t.alpha<1?t.alpha=Math.min(1,t.alpha+.05):this.timer.remove(e)},this,this.newCityText1),this.timer.add(3e3,function(t){e=this.timer.loop(100,function(t){t.alpha>0?t.alpha-=.05:this.timer.remove(e)},this,this.newCityText1)},this)}}function mouseOverListener(e){e.node.sillhouette.tint=16775856,e.node.sillhouette.visible=!0,game.nodeCurrentOver=e.node}function mouseOutListener(e){e.node.clicked||(e.node.sillhouette.visible=!1),game.nodeCurrentOver=null}function mouseClickListener(e){game.nodeclicked=e.node,game.buttonPress=!0,game.cableMode?shopCablePanel.enableButton(e.node):"server"==e.node.type?nodeInfoServerPanel.setToNode(e.node):"resource"==e.node.type?nodeResourcePanel.setToNode(e.node):nodeCityPanel.setToNode(e.node)}var tutorial,tutorialConfig={preload:preload,create:create,update:update};function preload(){slickUI.load("assets/ui/kenney/kenney.json")}function create(){game.input.keyboard.addKey(Phaser.Keyboard.ESC).onDown.add(function(){tutorialOn=!1,game.state.start("menu")},this),graphicsManager=new GraphicsManager,worldGenerator=new WorldGenerator,gameGroup=game.add.group(),cables=game.add.group(),packets=game.add.group(),nodes=game.add.group(),ui=game.add.group(),arrow=game.add.group(),game.arrow=game.add.group(arrow),game.arrowSprite=game.arrow.create(450,300,"arrow"),game.arrowSprite.anchor.setTo(.5),arrow.add(game.arrowSprite),game.arrowSprite.visible=!1,game.tutorialPanel=new TutorialPanel,game.network=new Network,graphicsManager.network=game.network,paused=!1,timers=[]}function changeTutorialStep(){if(1==tutorialScreen){game.types=[];for(var e=0;e<RESOURCE_COLORS.length;++e)game.types.push(new ResourceUnit(e,10+Math.max(2*Math.ceil((e-2)/2),0),40,RESOURCE_COLORS[e]));for(var t=worldGenerator.generateCityDistribution(game.types);t[0].prob<.3;)t=worldGenerator.generateCityDistribution(game.types);game.newCity=new City(game.network,200,300,1,t),game.newServer=new Server(game.network,450,300,1/0,5,1),game.network.add_node(game.newServer);new Resource(game.network,700,260,game.types[5]);new Resource(game.network,740,300,game.types[2]),new Resource(game.network,700,300,game.types[1]),new Resource(game.network,720,340,game.types[4]),new Resource(game.network,680,340,game.types[3]),game.newResource=new Resource(game.network,660,300,game.types[0]),game.tutorialPanel.updatePanel(55,40,"This is a city. The arcs around it represent the proportion of packet types it sends out."),game.arrowSprite.visible=!0,arrowPosition(game.arrowSprite,200,220,Math.PI/2)}else if(2==tutorialScreen)game.tutorialPanel.updatePanel(305,40,"This is a server. The server connects to the cities and resources, and sends packets to where they need to go."),arrowPosition(game.arrowSprite,450,220,Math.PI/2);else if(3==tutorialScreen)game.tutorialPanel.updatePanel(305,40,"You can buy a server by clicking on an empty space. A button will appear for you to confirm if you want to buy a server.");else if(4==tutorialScreen)game.tutorialPanel.updatePanel(555,40,"These are resources. The different colours represent different types of resource."),arrowPosition(game.arrowSprite,700,220,Math.PI/2);else if(5==tutorialScreen){var i=new Cable(game.network,game.newCity,game.newServer,1,50,1);game.network.add_cable(i);i=new Cable(game.network,game.newServer,game.newResource,1,50,1);game.network.add_cable(i),game.tutorialPanel.updatePanel(205,80,"This is a cable. Packets travel along these cables to get to the resource they need and then travel back to the city."),arrowPosition(game.arrowSprite,350,260,Math.PI/2),game.newCity.create_request=function(){var e=game.types[0],t=new Packet(this,e,null,e.timeout);this.network.add_packet(t);var i=game.network.get_nearest_resource(this,e);game.network.get_cable(this,i).send_packet(this,t),new MyTimer(1500,this.create_request,this)},game.newCity.create_request()}else if(6==tutorialScreen)game.tutorialPanel.updatePanel(205,80,'Cables can be bought by clicking on a node, choosing "Buy/Add Server" and then selecting the place you want to connect.');else if(7==tutorialScreen)game.tutorialPanel.updatePanel(205,80,"The colour of packets represent the resource they need. Unfulfilled packets are slightly darker and have a black dot in the middle."),game.arrowSprite.visible=!1;else if(8==tutorialScreen)game.statusPanel=new StatusPanel(PANEL_MARGIN,PANEL_MARGIN,STATUS_PANEL_WIDTH,STATUS_PANEL_HEIGHT),game.arrowSprite.visible=!0,arrowPosition(game.arrowSprite,231,59,Math.PI),game.tutorialPanel.updatePanel(258,8,"This is your status. It tells you the amount of credit you have, your score, and your total amount of time spent unpaused.");else if(9==tutorialScreen)game.tutorialPanel.updatePanel(258,8,"You start with 2000 credits, and it increases every time you fulfil a request.");else if(10==tutorialScreen){var n=game.add.button(game.width-40,8,"buttonPause",function(){},this,1,0,1,0);n.onInputDown.add(function(){pause(),game.buttonPress=!0,n.visible=!1,s.visible=!0},this);var s=game.add.button(game.width-40,8,"buttonPause",function(){},this,3,2,3,2);game.buttonPlay=s,game.buttonPause=n,n.visible=!1,pause(),s.onInputDown.add(function(){pause(),game.buttonPress=!0,n.visible=!0,s.visible=!1},this);var r=game.add.button(game.width-40,86,"buttonReload",function(){},this,1,0,1,0);buttonSpeed1=game.add.button(game.width-40,47,"buttonSpeed",function(){},this,1,0,1,0),buttonSpeed1.onInputDown.add(function(){changeSpeed(2),game.buttonPress=!0,buttonSpeed1.visible=!1,buttonSpeed2.visible=!0}),buttonSpeed2=game.add.button(game.width-40,47,"buttonSpeed",function(){},this,3,2,3,2),buttonSpeed2.onInputDown.add(function(){changeSpeed(4),game.buttonPress=!0,buttonSpeed2.visible=!1,buttonSpeed4.visible=!0}),buttonSpeed2.visible=!1,buttonSpeed4=game.add.button(game.width-40,47,"buttonSpeed",function(){},this,5,4,5,4),buttonSpeed4.onInputDown.add(function(){changeSpeed(1),game.buttonPress=!0,buttonSpeed4.visible=!1,buttonSpeed1.visible=!0}),buttonSpeed4.visible=!1,r.onInputDown.add(function(){}),game.buttonSpeed=buttonSpeed1,game.buttonSpeed2=buttonSpeed2,game.buttonSpeed4=buttonSpeed4,game.tutorialPanel.updatePanel(520,8,"These are the pause, speed and restart buttons. Pausing the game allows you to build a network without time pressure"),arrowPosition(game.arrowSprite,835,50,0)}else if(11==tutorialScreen)game.tutorialPanel.updatePanel(520,8,"The game will start paused to allow you to build an initial network.");else if(12==tutorialScreen){paused&&(pause(),game.buttonPlay.visible=!1,game.buttonPause.visible=!0),changeSpeed(1),game.buttonSpeed.visible=!0,game.buttonSpeed2.visible=!1,game.buttonSpeed4.visible=!1,game.buttonPause.onInputDown.removeAll(),game.buttonSpeed.onInputDown.removeAll(),graphicsManager.satisfactionBarInit(),arrowPosition(game.arrowSprite,350,260,Math.PI/2),game.types[0]=new ResourceUnit(0,10+Math.max(2*Math.ceil(-1),0),3,RESOURCE_COLORS[0]),game.newResource=new Resource(game.network,660,300,game.types[0]);i=new Cable(game.network,game.newServer,game.newResource,1,50,1);game.network.add_cable(i),game.newCity.create_request=function(){var e=game.types[0],t=new Packet(this,e,null,e.timeout);this.network.add_packet(t);var i=game.network.get_nearest_resource(this,e);game.network.get_cable(this,i).send_packet(this,t),new MyTimer(1500,this.create_request,this)},game.tutorialPanel.updatePanel(210,80,"After a certain amount of time an unfulfilled packet will die. This will be represented by a black circle with an outline of its colour.")}else if(13==tutorialScreen)game.tutorialPanel.updatePanel(210,80,"Any dead packets will be removed before they are sent down another cable.");else if(14==tutorialScreen)game.tutorialPanel.updatePanel(210,80,"This is the penalty bar. Every time a packet dies its colour will be added to this. The game ends when this is filled."),arrowPosition(game.arrowSprite,350,60,-Math.PI/2);else if(15==tutorialScreen){game.types[0]=new ResourceUnit(0,10+Math.max(2*Math.ceil(-1),0),1/0,RESOURCE_COLORS[0]),game.newResource=new Resource(game.network,660,300,game.types[0]);i=new Cable(game.network,game.newServer,game.newResource,1,50,1);game.network.add_cable(i),game.newCity.create_request=function(){var e=game.types[0],t=new Packet(this,e,null,e.timeout);this.network.add_packet(t);var i=game.network.get_nearest_resource(this,e);game.network.get_cable(this,i).send_packet(this,t),game.time.events.add(300,this.create_request,this)},arrowPosition(game.arrowSprite,239,332,-Math.PI/2),game.tutorialPanel.updatePanel(99,352,"The inner bar is how full a node is. When a node is full, the reward of all packets sent from that node will be decreased.")}else 16==tutorialScreen?(game.tutorialPanel.updatePanel(305,400,"Too many packets in nodes can be solved by upgrading servers or cables."),game.arrowSprite.visible=!1):17==tutorialScreen?game.tutorialPanel.updatePanel(305,400,'Reselecting a cable gives the option of upgrading it; clicking on a server gives an "Upgrade Server" button.'):18==tutorialScreen?game.tutorialPanel.updatePanel(305,400,"Upgrading a server gives it a greater capacity and allows more nodes to be connected to it."):19==tutorialScreen?game.tutorialPanel.updatePanel(305,400,"Upgrading a cable allows more packets to be sent in a given time and packets will also travel down the cable faster."):20==tutorialScreen?game.tutorialPanel.updatePanel(305,400,"The level of a cable is given by its colour and the details of a server are given when it is clicked."):21==tutorialScreen?(game.tutorialPanel.updatePanel(305,400,"That concludes the tutorial. Press the button below to return to the main menu."),game.tutorialPanel.nextButtonText.value="Return to Menu",game.tutorialPanel.nextButtonText.center()):(tutorialOn=!1,game.state.start("menu"))}function update(){tutorialScreen<8&&(totalTime+=game.time.elapsedMS*speed,timers.forEach(function(e){e.expired?timers.splice(timers.indexOf(e),1):e.check()})),tutorialScreen>=8&&(game.statusPanel.updateCredit(currentCredit),paused||(totalTime+=game.time.elapsedMS*speed,timers.forEach(function(e){e.expired?timers.splice(timers.indexOf(e),1):e.check()})))}function arrowPosition(e,t,i,n){e.x=t,e.y=i,e.rotation=n}var INITIAL_BOUNDS_RADIUS=700,INITIAL_MIN_DIST=220,MINIMAL_MIN_DIST=170,FIXED_CITY_LAMBDA=.8;class WorldGenerator{constructor(){this.minDist=INITIAL_MIN_DIST,this.boundsRadius=INITIAL_BOUNDS_RADIUS,this.types=[],this.hasResource=[],this.activeTypesCount=3,this.citySpeed=1.5}inCircle(e,t,i){return Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2)<=Math.pow(t,2)}canPlace(e){if(!this.inCircle([0,0],this.boundsRadius,e))return!1;for(var t=0;t<network.nodes.length;++t){var i=[network.nodes[t].x,network.nodes[t].y];if(this.inCircle(i,this.minDist,e))return!1}return!0}generateResources(e,t){for(var n=0;n<e;){if(o=2*Math.random()-1,a=2*Math.random()-1,o*=this.boundsRadius,a*=this.boundsRadius,this.canPlace([o,a])){var s=Math.floor(Math.random()*t.length),r=t[s];this.hasResource[s]=!0,new Resource(network,o,a,r),n++}}for(i=0;i<this.activeTypesCount;i++)for(;!this.hasResource[i];){var o,a;if(o=2*Math.random()-1,a=2*Math.random()-1,o*=this.boundsRadius,a*=this.boundsRadius,this.canPlace([o,a])){r=t[i];this.hasResource[i]=!0,new Resource(network,o,a,r)}}}generateCityDistribution(e){for(var t=[],i=0;i<e.length-1;++i)t.push(Math.floor(11*Math.random()));t.sort(function(e,t){return e-t});var n=0,s=[];for(i=0;i<t.length;++i)s.push({prob:(t[i]-n)/10,resource_unit:e[i]}),n=t[i];return s.push({prob:(10-n)/10,resource_unit:e[e.length-1]}),s}generateCities(e,t){for(var i=0;i<e;){var n,s;if(n=2*Math.random()-1,s=2*Math.random()-1,n*=this.boundsRadius,s*=this.boundsRadius,this.canPlace([n,s])){var r=this.generateCityDistribution(t);new City(network,n,s,FIXED_CITY_LAMBDA,r);i++}}}newRadiusTween(e){var t=Math.min(.8*e,.32*INITIAL_BOUNDS_RADIUS);game.add.tween(this).to({boundsRadius:"+"+t.toString()},5*Phaser.Timer.MINUTE,Phaser.Easing.Linear.NONE,!0).onComplete.add(function(e,t,i){this.newRadiusTween(i)},this,0,t)}newMinDistTween(){var e=Math.max(MINIMAL_MIN_DIST,.985*this.minDist);game.add.tween(this).to({minDist:e},Phaser.Timer.MINUTE,Phaser.Easing.Linear.NONE,!0).onComplete.add(this.newMinDistTween,this)}newResourceUnitTimer(){this.activeTypesCount++,this.activeTypesCount!=this.types.length&&new MyTimer(3*Phaser.Timer.MINUTE,this.newResourceUnitTimer,this)}newResourcesTimer(){var e=this.types.slice(0,this.activeTypesCount);this.generateResources(1,e),new MyTimer(7*Phaser.Timer.MINUTE/12,this.newResourcesTimer,this)}newCitiesTimer(){var e=this.types.slice(0,this.activeTypesCount);this.generateCities(1,e),graphicsManager.newCityText(),this.citySpeed=Math.max(this.citySpeed-.25,1),new MyTimer(Phaser.Timer.MINUTE*this.citySpeed,this.newCitiesTimer,this)}initGameWorld(){for(var e=0;e<RESOURCE_COLORS.length;++e)this.types.push(new ResourceUnit(e,10+Math.max(2*Math.ceil((e-2)/2),0),30,RESOURCE_COLORS[e])),this.hasResource.push(!1);var t=this.types.slice(0,this.activeTypesCount);this.generateResources(7,t),this.generateCities(3,t),this.newRadiusTween(.5*INITIAL_BOUNDS_RADIUS),this.newMinDistTween(),new MyTimer(3.8*Phaser.Timer.MINUTE,this.newResourceUnitTimer,this),new MyTimer(1.9*Phaser.Timer.MINUTE,this.newResourcesTimer,this),new MyTimer(2*Phaser.Timer.MINUTE,this.newCitiesTimer,this)}}class Cable{constructor(e,t,i,n,s,r){this.network=e,this.distance=t.dist(i),this.node_1=t,this.node_2=i,this.lambda=n,this.v=s,this.B1=[],this.B2=[],this.can_send_1=!0,this.can_send_2=!0,this.level=r,graphicsManager.spriteInitCable(this)}total_time(e=null){var t=this.distance/this.v,i=0;return e==this.node_1?i=this.lambda*this.B1.length:e==this.node_2&&(i=this.lambda*this.B2.length),t+i}send_packet(e,t){return t.cable=this,this.node_1==e?(t.cableSide=1,this.B1.push(t),graphicsManager.arcUpdate(e),this.can_send_1&&this.releasePacket(1,!1)):this.node_2==e&&(t.cableSide=2,this.B2.push(t),graphicsManager.arcUpdate(e),this.can_send_2&&this.releasePacket(2,!1)),!1}releasePacket(e,t){if(t&&(1==e?this.can_send_1=!0:2==e&&(this.can_send_2=!0)),1==e){if(0==this.B1.length)return;this.can_send_1=!1,(i=this.B1.shift()).travelling=!0,graphicsManager.spriteInitPacket(i,this,this.node_1,this.node_2),this.network.packetsInNode(this.node_1)>this.node_1.capacity&&i.rewardPenalty(),new MyTimer(Phaser.Timer.SECOND*this.lambda,this.releasePacket,this,1,!0)}else if(2==e){if(0==this.B2.length)return;var i;this.can_send_2=!1,(i=this.B2.shift()).travelling=!0,graphicsManager.spriteInitPacket(i,this,this.node_2,this.node_1),this.network.packetsInNode(this.node_2)>this.node_2.capacity&&i.rewardPenalty(),new MyTimer(Phaser.Timer.SECOND*this.lambda,this.releasePacket,this,2,!0)}}removePacket(e,t){1==e?(this.B1=this.B1.splice(this.B1.indexOf(t),1),graphicsManager.arcUpdate(this.node_1)):(this.B2=this.B2.splice(this.B2.indexOf(t),1),graphicsManager.arcUpdate(this.node_2))}}class City extends Node{constructor(e,t,i,n,s){super(e,t,i,"city"),this.seed=Random.engines.mt19937().autoSeed(),this.p=s,this.exp_distro=Prob.exponential(n),tutorialOn||this.newTimer(),this.waitingPool=[],this.capacity=50,graphicsManager.spriteInitCity(this)}info(){for(var e="",t=0;t<this.p.length;++t)e+=String(100*this.p[t].prob)+"% of "+this.p[t].resource_unit.color.toString(16)+"\n";return e}process_packet(e){if(this.network.delete_packet(e),e.destination!=this)return!1;if(e.state){e.delivered=!0;var t=e.content.reward-e.penalty;return currentCredit+=t,lifetimeCredit+=t,!0}return!1}draw_request(){for(var e=Math.random(),t=0,i=0;t<=e;)t+=this.p[i].prob,i++;return i--,t-=this.p[i].prob,this.p[i].resource_unit}newTimer(){this.nextTime=Phaser.Timer.SECOND*this.exp_distro.apply(this.seed),new MyTimer(this.nextTime,this.create_request,this)}releaseWaitingPool(){for(var e=[];this.waitingPool.length>0;){var t=this.waitingPool.shift();if(t.state){var i=this.network.get_nearest_resource(this,t.destination);if(null==i)e.push(t);else this.network.get_cable(this,i).send_packet(this,t)}}this.waitingPool=e}removefromWaiting(e){this.waitingPool.shift();graphicsManager.arcUpdate(this)}create_request(){var e=this.draw_request(),t=new Packet(this,e,null,e.timeout);this.network.add_packet(t);var i=this.network.get_nearest_resource(this,e);null==i?this.waitingPool.push(t):this.network.get_cable(this,i).send_packet(this,t);graphicsManager.arcUpdate(this),this.newTimer()}}class Network{constructor(){this.nodes=[],this.cables=[],this.packets=[],this.distances=[],this.edges=[],this.adjacency_lists=[]}delete_packet(e){var t=this.packets.indexOf(e);return-1!=t&&(this.packets.splice(t,1),!0)}get_cables(e){for(var t=[],i=0;i<this.cables.length;++i)this.cables[i].node_1!=e&&this.cables[i].node_2!=e||t.push(this.cables[i]);return t}update_distances(){for(var e=0;e<this.nodes.length;++e)this.dijkstra(e)}dijkstra(e){for(var t=[],i=0;i<this.nodes.length;++i)this.distances[e][i]=1/0,this.edges[e][i]=null,t.push(!1);this.distances[e][e]=0;var n=new PriorityQueue({comparator:function(e,t){return e[0]-t[0]}});for(n.queue([0,e]);0!=n.length;){var s=n.dequeue()[1];if(!t[s]&&(this.nodes[s]instanceof Server||s==e)){t[s]=!0;for(i=0;i<this.adjacency_lists[s].length;++i){var r=this.adjacency_lists[s][i][0],o=this.adjacency_lists[s][i][1],a=o.total_time(this.nodes[s]);t[r]||this.distances[e][s]+a<this.distances[e][r]&&(this.distances[e][r]=this.distances[e][s]+a,this.edges[e][r]=o,n.queue([this.distances[e][r],r]))}}}}add_node(e){if(-1!=this.nodes.indexOf(e))return!1;var t=this.nodes.length;this.nodes.push(e),this.adjacency_lists.push([]),this.distances.push([]),this.edges.push([]);for(var i=0;i<this.nodes.length;++i)this.distances[t][i]=1/0,this.distances[i][t]=1/0,this.edges[t][i]=null,this.edges[i][t]=null;return this.distances[t][t]=0,!0}packetsInNode(e){var t=0;e instanceof City&&(t+=e.waitingPool.length);for(var i=0;i<this.cables.length;++i)this.cables[i].node_1==e?t+=this.cables[i].B1.length:this.cables[i].node_2==e&&(t+=this.cables[i].B2.length);return t}can_connect(e,t){var i=this.nodes.indexOf(e),n=this.nodes.indexOf(t);if(e==t)return!1;for(var s=0;s<this.adjacency_lists[i].length;++s)if(this.adjacency_lists[i][s][0]==n)return!1;if(!(e instanceof Server||t instanceof Server))return!1;var r=!0,o=!0;return e instanceof Server&&(r=e.connected_nodes<e.max_nodes),t instanceof Server&&(o=t.connected_nodes<t.max_nodes),r&&o}add_cable(e){if(this.can_connect(e.node_1,e.node_2)){e.node_1.connect_with(e.node_2),e.node_2.connect_with(e.node_1),this.cables.push(e);var t=this.nodes.indexOf(e.node_1),i=this.nodes.indexOf(e.node_2);this.adjacency_lists[t].push([i,e]),this.adjacency_lists[i].push([t,e]),this.update_distances();for(var n=0;n<this.nodes.length;++n)this.nodes[n]instanceof City&&(paused?release.push(this.nodes[n]):this.nodes[n].releaseWaitingPool());return!0}return!1}add_packet(e){this.packets.push(e)}get_cable(e,t){var i=this.nodes.indexOf(e),n=this.nodes.indexOf(t);return this.edges[n][i]}get_adjacent_cable(e,t){for(var i=this.nodes.indexOf(e),n=this.nodes.indexOf(t),s=0;s<this.adjacency_lists[i].length;++s)if(this.adjacency_lists[i][s][0]==n)return this.adjacency_lists[i][s][1];return null}get_nearest_resource(e,t){for(var i=this.nodes.indexOf(e),n=[],s=0;s<this.nodes.length;++s){var r=this.nodes[s];r instanceof Resource&&r.resource_unit==t&&this.distances[i][s]<30&&n.push({node:r,distance:this.distances[i][s]})}if(0==n.length)return null;var o=(n=n.map(function(e){return{node:e.node,distance:1/e.distance**3}})).map(function(e){return e.distance}).reduce(function(e,t){return e+t},0);n=n.map(function(e){return{node:e.node,distance:e.distance/o}});for(var a=Math.random(),h=n[s=0].distance;h<a;)h+=n[s+=1].distance;return n[s].node}}class Packet{constructor(e,t,i,n){this.origin=e,this.destination=t,this.content=i,this.state=!0,this.delivered=!1,this.travelling=!1,this.cable=null,this.cableSide=0,this.id=packetCount,this.penalty=0,packetCount++,new MyTimer(Phaser.Timer.SECOND*n,this.die,this)}die(){this.delivered||(this.state=!1,currentPenalty++,this.travelling||(null==this.cable?(this.origin.removefromWaiting(this),graphicsManager.arcUpdate(this.origin)):this.cable.removePacket(this.cableSide,this)),tutorialOn||network.delete_packet(this),null==this.content?deadPackets[this.destination.type]+=1:deadPackets[this.content.type]+=1,graphicsManager.satisfactionBarUpdate(),this.travelling&&graphicsManager.deadPacket(this))}rewardPenalty(){this.penalty=Math.min(5,this.penalty+2)}}class ResourceUnit{constructor(e,t,i,n){this.type=e,this.reward=t,this.timeout=i,this.color=n}}class Resource extends Node{constructor(e,t,i,n){super(e,t,i,"resource"),this.resource_unit=n,this.color=this.resource_unit.color,graphicsManager.spriteInitResource(this),this.capacity=1/0}info(){return"Type: resource\n"}process_packet(e){return e.state?e.destination==this.resource_unit&&(e.destination=e.origin,e.origin=this,e.content=this.resource_unit,this.network.get_cable(this,e.destination).send_packet(this,e)):(this.network.delete_packet(e),!0)}}var NEW_SERVER_CAPACITY=20;class Server extends Node{constructor(e,t,i,n,s,r){super(e,t,i,"server"),this.max_nodes=s,this.connected_nodes=0,this.level=1,this.capacity=n,graphicsManager.spriteInitServer(this)}info(){return"Level: "+String(this.level)+" -> "+String(this.level+1)+"\nCapacity: "+String(this.capacity)+" -> "+String(this.capacity+NEW_SERVER_CAPACITY)+"\nPorts: "+String(this.max_nodes)+" -> "+String(this.max_nodes+1)+"\n"}connect_with(e){this.connected_nodes++}process_packet(e){if(!e.state)return this.network.delete_packet(e),!0;if(graphicsManager.arcUpdate(this),e.destination instanceof Node)return this.network.get_cable(this,e.destination).send_packet(this,e);if(e.destination instanceof ResourceUnit){var t=this.network.get_nearest_resource(this,e.destination);return this.network.get_cable(this,t).send_packet(this,e)}return!1}cost(){return Math.floor(NEW_SERVER_COST+5*this.level*(10+this.level))}}class MyTimer{constructor(e,t,i,...n){this.timeStart=totalTime,this.duration=e,this.callback=t.bind(i),this.callbackContext=i,this.args=n,this.expired=!1,timers.push(this)}check(){this.timeStart+this.duration<=totalTime&&(this.callback.apply(this.callbackContext,this.args),this.expired=!0)}}class NodeCityPanel extends Panel{constructor(e,t,i,n){super(e,t,i,n,"City");var s=this.header.y+this.header.size+PANEL_LINE_DIST;this.content=new SlickUI.Element.Text(0,s,""),this.panel.add(this.content),this.constructAddCableButton(),this.width=i,this.height=n}changeInfo(e){this.content.value=e}setToNode(e){null!=game.currentActivePanel&&(game.currentActivePanel.visible=!1,game.currentActivePanel=null,shopServerPanel.nowUp=!0),this.node=e,this.visible=!0,game.currentActivePanel=this;var t=gameGroup.worldPosition.x+e.sprite.x*gameGroup.worldScale.x-this.panel.width/2,i=gameGroup.worldPosition.y+(e.sprite.y-e.sprite.offsetY+e.sprite.height+10)*gameGroup.worldScale.y,n=t,s=i;n+this.panel.width>game.width?n=game.width-this.panel.width:n<0&&(n=0),i+this.panel.height>game.height?s=game.height-this.panel.height:s<0&&(s=0),this.moveTo(n,s)}constructAddCableButton(){var e=this.panel.container.height-35,t=this.panel.container.width;this.buyCableButton=new SlickUI.Element.Button(0,e,t,30),this.panel.add(this.buyCableButton),this.buyCableButtonText=new SlickUI.Element.Text(0,0,"Add/Upgrade Cable"),this.buyCableButton.add(this.buyCableButtonText).center(),this.buyCableButton.events.onInputDown.add(function(){game.buttonPress=!0,game.nodeclicked=this.node,this.visible=!1,shopCablePanel.setHeader("Choose Destination"),shopCablePanel.buyCableButton.visible=!1,shopCablePanel.setToNode(this.node)},this)}}class NodeInfoPanel extends Panel{constructor(e,t,i,n){super(e,t,i,n,"Node information");var s=this.header.y+this.header.size+PANEL_LINE_DIST;this.content=new SlickUI.Element.Text(0,s,"content"),this.panel.add(this.content)}changeInfo(e){this.content.value=e}setToNode(e){this.changeInfo(e.info());var t=gameGroup.worldPosition.x+e.sprite.x*gameGroup.worldScale.x-this.panel.width/2,i=gameGroup.worldPosition.y+(e.sprite.y-e.sprite.offsetY+e.sprite.height+10)*gameGroup.worldScale.y,n=t,s=i;n+this.panel.width>game.width?n=game.width-this.panel.width:n<0&&(n=0),i+this.panel.height>game.height&&(s=game.height-this.panel.height),this.moveTo(n,s)}}function nodeInfoClickListener(){nodeInfoPanel.visible=!1}function nodeInfoOverListener(e){"server"==e.type||(nodeInfoPanel.setToNode(e),nodeInfoPanel.visible=!0)}function nodeInfoOutListener(){nodeInfoPanel.visible=!1}NEW_SERVER_CAPACITY=20;class NodeInfoServerPanel extends Panel{constructor(e,t,i,n){super(e,t,i,n,"Server Information");var s=this.header.y+this.header.size+PANEL_LINE_DIST;this.content=new SlickUI.Element.Text(0,s,"content"),this.panel.add(this.content),this.constructUpdateServerButton(),this.constructAddCableButton()}changeInfo(e){this.content.value=e}setToNode(e){null!=game.currentActivePanel&&(game.currentActivePanel.visible=!1,game.currentActivePanel=null,shopServerPanel.nowUp=!0),this.node=e,this.visible=!0,game.currentActivePanel=this,this.changeInfo(e.info()),this.buyServerButtonText.value="Upgrade ("+String(this.node.cost())+")",this.buyServerButtonText.center();var t=gameGroup.worldPosition.x+e.sprite.x*gameGroup.worldScale.x-this.panel.width/2,i=gameGroup.worldPosition.y+(e.sprite.y-e.sprite.offsetY+e.sprite.height+10)*gameGroup.worldScale.y,n=t,s=i;n+this.panel.width>game.width?n=game.width-this.panel.width:n<0&&(n=0),i+this.panel.height>game.height?s=game.height-this.panel.height:s<0&&(s=0),this.moveTo(n,s)}constructUpdateServerButton(){var e=this.panel.container.height-70,t=this.panel.container.width;this.buyServerButton=new SlickUI.Element.Button(0,e,t,30),this.panel.add(this.buyServerButton),this.buyServerButtonText=new SlickUI.Element.Text(0,0,""),this.buyServerButton.add(this.buyServerButtonText).center(),this.buyServerButton.events.onInputDown.add(function(){game.nodeclicked=!0,game.buttonPress=!0,currentCredit<this.node.cost()?(this.buyServerButtonText.value="Upgrade ("+String(this.node.cost())+")",this.buyServerButtonText.center(),game.time.events.add(1.3*Phaser.Timer.SECOND,function(){this.buyServerButtonText.value="Upgrade ("+String(this.node.cost())+")",this.buyServerButtonText.center()},this)):(this.node.max_nodes+=1,this.node.capacity+=NEW_SERVER_CAPACITY,currentCredit-=this.node.cost(),this.node.level+=1,this.setToNode(this.node))},this)}constructAddCableButton(){var e=this.panel.container.height-35,t=this.panel.container.width;this.buyCableButton=new SlickUI.Element.Button(0,e,t,30),this.panel.add(this.buyCableButton),this.buyCableButtonText=new SlickUI.Element.Text(0,0,"Add/Upgrade Cable"),this.buyCableButton.add(this.buyCableButtonText).center(),this.buyCableButton.events.onInputDown.add(function(){game.buttonPress=!0,game.nodeclicked=this.node,this.visible=!1,shopCablePanel.setHeader("Choose Destination"),shopCablePanel.buyCableButton.visible=!1,shopCablePanel.setToNode(this.node)},this)}}class NodeResourcePanel extends Panel{constructor(e,t,i,n){super(e,t,i,n,"Resource");var s=this.header.y+this.header.size+PANEL_LINE_DIST;this.content=new SlickUI.Element.Text(0,s,""),this.panel.add(this.content),this.constructAddCableButton(),this.width=i,this.height=n}setToNode(e){null!=game.currentActivePanel&&(game.currentActivePanel.visible=!1,game.currentActivePanel=null,shopServerPanel.nowUp=!0),this.node=e,this.visible=!0,game.currentActivePanel=this;var t=gameGroup.worldPosition.x+e.sprite.x*gameGroup.worldScale.x-this.panel.width/2,i=gameGroup.worldPosition.y+(e.sprite.y-e.sprite.offsetY+e.sprite.height+10)*gameGroup.worldScale.y,n=t,s=i;n+this.panel.width>game.width?n=game.width-this.panel.width:n<0&&(n=0),i+this.panel.height>game.height?s=game.height-this.panel.height:s<0&&(s=0),this.moveTo(n,s)}constructAddCableButton(){var e=this.panel.container.height-35,t=this.panel.container.width;this.buyCableButton=new SlickUI.Element.Button(0,e,t,30),this.panel.add(this.buyCableButton),this.buyCableButtonText=new SlickUI.Element.Text(0,0,"Add/Upgrade Cable"),this.buyCableButton.add(this.buyCableButtonText).center(),this.buyCableButton.events.onInputDown.add(function(){game.buttonPress=!0,game.nodeclicked=this.node,this.visible=!1,shopCablePanel.setHeader("Choose Destination"),shopCablePanel.buyCableButton.visible=!1,shopCablePanel.setToNode(this.node)},this)}}var NEW_CABLE_LAMBDA=1,NEW_CABLE_V=50,CABLE_PENALTY=50;class ShopCablePanel extends Panel{constructor(e,t,i,n){super(e,t,i,n,"Choose Destination");var s=this.header.y+this.header.size+PANEL_LINE_DIST;this.content=new SlickUI.Element.Text(0,s,""),this.panel.add(this.content),this.constructAddCableButton(),this.node=null,this.nodeDest=null,this.existingCable=!1,this.xpos=e,this.ypos=t,this.timer=game.time.create(!1),this.timer.start(),foreverTimers.push(this.timer)}changeInfo(e){this.content.value=e}setToNode(e){this.node=e,this.visible=!0,game.currentActivePanel=this,game.cableMode=!0;var t=gameGroup.worldPosition.x+e.sprite.x*gameGroup.worldScale.x-this.panel.width/2,i=gameGroup.worldPosition.y+(e.sprite.y-e.sprite.offsetY+e.sprite.height+10)*gameGroup.worldScale.y,n=t,s=i;n+this.panel.width>game.width?n=game.width-this.panel.width:n<0&&(n=0),i+this.panel.height>game.height?s=game.height-this.panel.height:s<0&&(s=0),this.moveTo(n,s)}constructAddCableButton(){var e=this.panel.container.height-35,t=this.panel.container.width;this.buyCableButton=new SlickUI.Element.Button(0,e,t,30),this.panel.add(this.buyCableButton),this.buyCableButtonText=new SlickUI.Element.Text(0,0,"Buy Cable for "+String(this.cableCost(this.node,this.nodeDest))),this.buyCableButton.add(this.buyCableButtonText).center(),this.buyCableButton.visible=!1,this.buyCableButton.events.onInputDown.add(function(){if(game.buttonPress=!0,game.nodeclicked=this.node,this.visible=!1,currentCredit<this.cableCost())this.buyCableButtonText.value="Insufficient Funds",this.buyCableButtonText.center(),this.timer.add(1.3*Phaser.Timer.SECOND,function(){this.existingCable?this.buyCableButtonText.value="Upgrade for "+String(this.cableCost(this.node,this.nodeDest)):this.buyCableButtonText.value="Buy Cable for "+String(this.cableCost(this.node,this.nodeDest)),this.buyCableButtonText.center()},this);else if(this.existingCable){currentCredit-=this.cableCost(),this.cable.lambda-=.15,this.cable.level+=1;var e=this.cable.level;if(this.cable.v+=50+4*Math.pow(Math.floor(e/2),2),network.update_distances(),e<=6)this.cable.graphics.tint=CABLE_COLORS[e-1];else if(7==e){var t=game.time.create(!1);foreverTimers.push(t),this.cable.timer=t.loop(100,function(e){e.version+=1,e.version==CABLE_COLORS.length&&(e.version=2);e.graphics.tint=CABLE_COLORS[e.version]},this.cable,this.cable),this.cable.version=2,t.start()}else this.cable.timer.delay=100/(e-6);this.enableButton(this.nodeDest)}else{currentCredit-=this.cableCost();var i=new Cable(network,this.node,this.nodeDest,NEW_CABLE_LAMBDA,NEW_CABLE_V,1);network.add_cable(i),this.enableButton(this.nodeDest)}},this)}cableCheck(e){return this.nodeDest=e,this.buyCableButton.visible=!1,this.getCable(),null!=this.cable?(this.setHeader("Upgrade or Reselect"),this.buyCableButtonText.value="Upgrade for "+String(this.cableCost(this.node,this.nodeDest)),!0):network.can_connect(this.node,this.nodeDest)?(this.setHeader("Buy or Reselect"),this.buyCableButtonText.value="Buy Cable for "+String(this.cableCost(this.node,this.nodeDest)),!0):"server"==this.node.type&&this.node.connected_nodes==this.node.max_nodes?(this.setHeader("Source Server Full"),game.time.create(!0).add(1.3*Phaser.Timer.SECOND,function(){this.setHeader("Choose Destination")},this),!1):"server"==this.nodeDest.type&&this.nodeDest.connected_nodes==this.nodeDest.max_nodes?(this.setHeader("Destination Full"),game.time.create(!0).add(1.3*Phaser.Timer.SECOND,function(){this.setHeader("Choose Destination")},this),!1):(this.setHeader("Cannot connect"),game.time.create(!0).add(1.3*Phaser.Timer.SECOND,function(){this.setHeader("Choose Destination")},this),!1)}cableCost(){if(null==this.node)return 0;this.getCable();var e=this.node.dist(this.nodeDest),t=Math.floor((e/4+e*e/5e3)/1.5)+CABLE_PENALTY;return this.existingCable?Math.floor(t*this.cable.level*(1+this.cable.level/3)):t}getCable(){this.cable=network.get_adjacent_cable(this.node,this.nodeDest),null==this.cable?this.existingCable=!1:this.existingCable=!0}enableButton(e){this.cableCheck(e)&&(this.buyCableButtonText.center(),this.buyCableButton.visible=!0)}}var NEW_SERVER_COST=100,NEW_SERVER_MAX_NODES=4;NEW_SERVER_CAPACITY=20;class ShopServerPanel extends Panel{constructor(e,t,i,n){super(e,t,i,n);var s=this.header.y+this.header.size+PANEL_LINE_DIST;this.content=new SlickUI.Element.Text(0,s,"content"),this.panel.add(this.content),this.constructBuyServerButton(),this.nowUp=!1,this.width=i,this.height=n,this.xpos=e,this.ypos=t}setToNode(e){if(this.node=e,game.currentActivePanel=this,this.visible=!0,this.buyServerButtonText.value="Buy Server ("+String(this.cost())+")",this.buyServerButtonText.center(),null==e)null==game.nodeclicked&&this.nowUp||(this.visible=!1,game.currentActivePanel=null,this.nowUp=!1),this.x=game.input.activePointer.position.x,this.xpos=this.x-this.width/2,this.xpos+this.width>game.width?this.xpos=game.width-this.width:this.xpos<0&&(this.xpos=0),this.y=game.input.activePointer.position.y,this.ypos=this.y,this.y+this.height>game.height&&(this.ypos=game.height-this.height),this.moveTo(this.xpos,this.ypos),this.content.value="";else{var t=e.max_nodes,i=e.capacity;this.content.value="Max Cables: \n    "+String(t)+" -> "+String(t+3)+"\n Capacity: \n    "+String(i)+" -> "+String(i+50),this.x=gameGroup.worldPosition.x+e.sprite.x*gameGroup.worldScale.x-this.panel.width/2,this.y=gameGroup.worldPosition.y+(e.sprite.y-e.sprite.offsetY+e.sprite.height+10)*gameGroup.worldScale.y,this.moveTo(this.x,this.y)}}constructBuyServerButton(){var e=this.panel.container.height-35,t=this.panel.container.width;this.buyServerButton=new SlickUI.Element.Button(0,e,t,30),this.panel.add(this.buyServerButton),this.buyServerButtonText=new SlickUI.Element.Text(0,0,"Buy Server ("+String(NEW_SERVER_COST)+")"),this.buyServerButton.add(this.buyServerButtonText).center(),this.buyServerButton.events.onInputDown.add(function(){if(game.nodeclicked=!0,game.buttonPress=!0,currentCredit<this.cost())this.buyServerButtonText.value="Insufficient Funds",this.buyServerButtonText.center(),game.time.events.add(1.3*Phaser.Timer.SECOND,function(){this.buyServerButtonText.value="Buy for "+String(this.cost()),this.buyServerButtonText.center()},this);else if(null==this.node){new Server(network,(this.x-gameGroup.worldPosition.x)/gameGroup.worldScale.x,(this.y-gameGroup.worldPosition.y)/gameGroup.worldScale.y,NEW_SERVER_CAPACITY,NEW_SERVER_MAX_NODES,1);game.currentActivePanel=null,this.visible=!1,this.nowUp=!1,currentCredit-=NEW_SERVER_COST}else this.node.max_nodes+=1,this.node.capacity+=NEW_SERVER_CAPACITY,currentCredit-=this.cost(),this.node.level+=1,this.setToNode(this.node)},this)}cost(){return null==this.node?NEW_SERVER_COST:Math.floor(NEW_SERVER_COST+5*this.node.level*(10+this.node.level))}}class StatusPanel extends Panel{constructor(e,t,i,n){super(e,t,i,n,"");var s=PANEL_LINE_DIST;this.creditText=new SlickUI.Element.Text(0,s,"Credit: 0\nScore: 0\nElapsed: 0:00.000",18,"#ffffff"),this.panel.add(this.creditText)}updateCredit(e){this.creditText.value="Credit: "+String(e)+"\nScore: "+String(lifetimeCredit)+"\nElapsed: "+formatTime(totalTime)}}class TutorialPanel extends Panel{constructor(){super(305,225,290,150,""),this.mainText=new SlickUI.Element.Text(0,0,"Welcome to the tutorial of Net-a-Switch. To leave the tutorial at any time press the ESCAPE key.",18,"#ffffff"),this.panel.add(this.mainText),this.constructNextButton()}constructNextButton(){var e=this.panel.height-35,t=this.panel.width;this.nextButton=new SlickUI.Element.Button(0,e,t,30),this.panel.add(this.nextButton),this.nextButtonText=new SlickUI.Element.Text(0,0,"Next"),this.nextButton.add(this.nextButtonText).center(),this.nextButton.events.onInputDown.add(function(){tutorialScreen+=1,changeTutorialStep()},this)}updatePanel(e,t,i){this.panel.x=e,this.panel.y=t,this.mainText.value=i}}SlickUI.namespace("Container"),SlickUI.Container.Container=function(e){this.root=null,e instanceof SlickUI.Container.Container||(this.root=e,e=null),this.parent=e,this.children=[],e?(this.root=e.root,this.displayGroup=this.root.game.add.group(),e.displayGroup.add(this.displayGroup),this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height):(this.displayGroup=this.root.game.add.group(),this.x=0,this.y=0,this.width=this.root.game.width,this.height=this.root.game.height)},SlickUI.Container.Container.prototype.add=function(e){return e.setContainer(this),"function"==typeof e.init&&e.init(),this.root.game.world.bringToTop(this.displayGroup),this.children.push(e),e},SlickUI.Container.Container.prototype.remove=function(e){e.unsetContainer();var t=this.children.indexOf(e);t>-1&&this.children.splice(t,1),e.destroy()},SlickUI.Container.Container.prototype.removeParent=function(){this.parent?this.parent.displayGroup.remove(this.displayGroup):this.root&&this.root.game.world.remove(this.displayGroup),this.root=void 0,this.parent=void 0},SlickUI.Container.Container.prototype.destroy=function(){this.removeParent(),this.displayGroup.destroy()},SlickUI.namespace("Element"),SlickUI.Element.Button=function(e,t,i,n){this._x=e,this._y=t,this._offsetX=e,this._offsetY=t,this._width=i,this._height=n,this.container=null},SlickUI.Element.Button.prototype.setContainer=function(e){this.container=new SlickUI.Container.Container(e)},SlickUI.Element.Button.prototype.unsetContainer=function(){this.container.removeParent()},SlickUI.Element.Button.prototype.init=function(){var e=this.container.root.game.cache.getJSON("slick-ui-theme"),t=this.container.x=this.container.parent.x+this._x,i=this.container.y=this.container.parent.y+this._y,n=this.container.width=Math.min(this.container.parent.width-this._x,this._width),s=this.container.height=Math.min(this.container.parent.height-this._y,this._height);this.container.x+=Math.round(e.button["border-x"]/2),this.container.y+=Math.round(e.button["border-y"]/2),this.container.width-=e.button["border-x"],this.container.height-=e.button["border-y"];var r=this.container.root.getRenderer("button").render(n,s);this.spriteOff=r[0],this.spriteOn=r[1],this.sprite=this.container.root.game.make.button(t,i),this.sprite.loadTexture(this.spriteOff.texture),this.container.displayGroup.add(this.sprite),this.sprite.x=t,this.sprite.y=i,this._offsetX=t,this._offsetY=i,this.sprite.fixedToCamera=!0;var o=!1;this.sprite.events.onInputOver.add(function(){o=!0},this),this.sprite.events.onInputOut.add(function(){o=!1},this),this.sprite.events.onInputDown.add(function(){this.sprite.loadTexture(this.spriteOn.texture)},this),this.sprite.events.onInputUp.add(function(){this.sprite.loadTexture(this.spriteOff.texture),o||this.sprite.events.onInputUp.halt()},this),this.events=this.sprite.events},SlickUI.Element.Button.prototype.add=function(e){return this.container.add(e)},SlickUI.Element.Button.prototype.destroy=function(){this.container.destroy()},Object.defineProperty(SlickUI.Element.Button.prototype,"x",{get:function(){return this._x-this.container.parent.x},set:function(e){this._x=e,this.container.displayGroup.x=this.container.parent.x+e-this._offsetX}}),Object.defineProperty(SlickUI.Element.Button.prototype,"y",{get:function(){return this._y-this.container.parent.y},set:function(e){this._y=e,this.container.displayGroup.y=this.container.parent.y+e-this._offsetY}}),Object.defineProperty(SlickUI.Element.Button.prototype,"visible",{get:function(){return this.container.displayGroup.visible},set:function(e){this.container.displayGroup.visible=e}}),Object.defineProperty(SlickUI.Element.Button.prototype,"alpha",{get:function(){return this.container.displayGroup.alpha},set:function(e){this.container.displayGroup.alpha=e}}),Object.defineProperty(SlickUI.Element.Button.prototype,"width",{get:function(){return this.container.width},set:function(e){var t=this.container.root.game.cache.getJSON("slick-ui-theme");this._width=Math.round(e+t.button["border-x"]),this.sprite.destroy(),this.init(),this.container.displayGroup.sendToBack(this.sprite)}}),Object.defineProperty(SlickUI.Element.Button.prototype,"height",{get:function(){return this.container.height},set:function(e){var t=this.container.root.game.cache.getJSON("slick-ui-theme");this._height=Math.round(e+t.button["border-y"]),this.sprite.destroy(),this.init(),this.container.displayGroup.sendToBack(this.sprite)}}),SlickUI.namespace("Element"),SlickUI.Element.Checkbox=function(e,t,i){this._x=e,this._y=t,this.container=null,this._checked=!1,this.type=i,void 0===i&&(this.type=SlickUI.Element.Checkbox.TYPE_CHECKBOX)},SlickUI.Element.Checkbox.TYPE_CHECKBOX=0,SlickUI.Element.Checkbox.TYPE_RADIO=1,SlickUI.Element.Checkbox.TYPE_CROSS=2,SlickUI.Element.Checkbox.prototype.setContainer=function(e){this.container=e},SlickUI.Element.Checkbox.prototype.unsetContainer=function(){this.container.removeParent()},SlickUI.Element.Checkbox.prototype.init=function(){var e,t=this.container.x+this._x,i=this.container.y+this._y;switch(this.type){case SlickUI.Element.Checkbox.TYPE_RADIO:e="radio";break;case SlickUI.Element.Checkbox.TYPE_CROSS:e="cross";break;default:e="check"}var n=this.container.root.getRenderer("checkbox").render(e);this.sprite=this.container.root.game.make.sprite(0,0,n[0].texture),this.sprite.x=t,this.sprite.y=i,this._spriteOff=n[0],this._spriteOn=n[1],this.displayGroup=this.container.root.game.add.group(),this.displayGroup.add(this.sprite),this.container.displayGroup.add(this.displayGroup),this.sprite.inputEnabled=!0,this.sprite.fixedToCamera=!0,this.input.useHandCursor=!0,this.events.onInputDown.add(function(){this.checked=!this.checked},this)},SlickUI.Element.Checkbox.prototype.destroy=function(){this.container.destroy()},Object.defineProperty(SlickUI.Element.Checkbox.prototype,"x",{get:function(){return this.displayGroup.x+this._x},set:function(e){this.displayGroup.x=e-this._x}}),Object.defineProperty(SlickUI.Element.Checkbox.prototype,"y",{get:function(){return this.displayGroup.y+this._y},set:function(e){this.displayGroup.y=e-this._y}}),Object.defineProperty(SlickUI.Element.Checkbox.prototype,"checked",{get:function(){return this._checked},set:function(e){this._checked=e,e?this.sprite.loadTexture(this._spriteOn.texture):this.sprite.loadTexture(this._spriteOff.texture)}}),Object.defineProperty(SlickUI.Element.Checkbox.prototype,"visible",{get:function(){return this.sprite.visible},set:function(e){this.sprite.visible=e}}),Object.defineProperty(SlickUI.Element.Checkbox.prototype,"alpha",{get:function(){return this.sprite.alpha},set:function(e){this.sprite.alpha=e}}),Object.defineProperty(SlickUI.Element.Checkbox.prototype,"events",{get:function(){return this.sprite.events}}),Object.defineProperty(SlickUI.Element.Checkbox.prototype,"input",{get:function(){return this.sprite.input}}),Object.defineProperty(SlickUI.Element.Checkbox.prototype,"width",{get:function(){return this.sprite.width},set:function(e){this.sprite.width=e}}),Object.defineProperty(SlickUI.Element.Checkbox.prototype,"height",{get:function(){return this.sprite.height},set:function(e){this.sprite.height=e}}),SlickUI.namespace("Element"),SlickUI.Element.DisplayObject=function(e,t,i,n,s){this._x=e,this._y=t,this._offsetX=e,this._offsetY=t,this.displayObject=i,this.container=null,this._width=n,this._height=s},SlickUI.Element.DisplayObject.prototype.setContainer=function(e){this.container=new SlickUI.Container.Container(e),void 0===this._width&&(this._width=this.container.root.game.width),void 0===this._height&&(this._height=this.container.root.game.height)},SlickUI.Element.DisplayObject.prototype.unsetContainer=function(){this.container.removeParent()},SlickUI.Element.DisplayObject.prototype.init=function(){var e=this.container.x=this.container.parent.x+this._x,t=this.container.y=this.container.parent.y+this._y;this.container.width=Math.min(this.container.parent.width-this._x,this._width),this.container.height=Math.min(this.container.parent.height-this._y,this._height),!this.displayObject instanceof Phaser.Sprite?this.sprite=this.container.root.game.make.sprite(e,t,this.displayObject):this.sprite=this.displayObject,this.container.displayGroup.add(this.sprite),this.sprite.x=e,this.sprite.y=t,this._offsetX=e,this._offsetY=t,this.sprite.fixedToCamera=!0},SlickUI.Element.DisplayObject.prototype.add=function(e){return this.container.add(e)},SlickUI.Element.DisplayObject.prototype.destroy=function(){this.container.destroy()},Object.defineProperty(SlickUI.Element.DisplayObject.prototype,"x",{get:function(){return this._x-this.container.parent.x},set:function(e){this._x=e,this.container.displayGroup.x=this.container.parent.x+e-this._offsetX}}),Object.defineProperty(SlickUI.Element.DisplayObject.prototype,"y",{get:function(){return this._y-this.container.parent.y},set:function(e){this._y=e,this.container.displayGroup.y=this.container.parent.y+e-this._offsetY}}),Object.defineProperty(SlickUI.Element.DisplayObject.prototype,"visible",{get:function(){return this.container.displayGroup.visible},set:function(e){this.container.displayGroup.visible=e}}),Object.defineProperty(SlickUI.Element.DisplayObject.prototype,"alpha",{get:function(){return this.container.displayGroup.alpha},set:function(e){this.container.displayGroup.alpha=e}}),Object.defineProperty(SlickUI.Element.DisplayObject.prototype,"inputEnabled",{get:function(){return this.sprite.inputEnabled},set:function(e){this.sprite.inputEnabled=e,this.input=e?this.sprite.input:null}}),Object.defineProperty(SlickUI.Element.DisplayObject.prototype,"events",{get:function(){return this.sprite.events}}),Object.defineProperty(SlickUI.Element.DisplayObject.prototype,"width",{get:function(){return this.container.width},set:function(e){this._width=e,this.sprite.destroy(),this.init(),this.container.displayGroup.sendToBack(this.sprite)}}),Object.defineProperty(SlickUI.Element.DisplayObject.prototype,"height",{get:function(){return this.container.height},set:function(e){this._height=e,this.sprite.destroy(),this.init(),this.container.displayGroup.sendToBack(this.sprite)}}),SlickUI.namespace("Element"),SlickUI.Element.Panel=function(e,t,i,n){this._x=e,this._y=t,this._offsetX=e,this._offsetY=t,this._width=i,this._height=n,this.container=null},SlickUI.Element.Panel.prototype.setContainer=function(e){this.container=new SlickUI.Container.Container(e)},SlickUI.Element.Panel.prototype.unsetContainer=function(){this.container.removeParent()},SlickUI.Element.Panel.prototype.init=function(){var e=this.container.root.game.cache.getJSON("slick-ui-theme"),t=this.container.x=this.container.parent.x+this._x,i=this.container.y=this.container.parent.y+this._y,n=this.container.width=Math.min(this.container.parent.width-this._x,this._width),s=this.container.height=Math.min(this.container.parent.height-this._y,this._height);this.container.x+=Math.round(e.panel["border-x"]/2),this.container.y+=Math.round(e.panel["border-y"]/2),this.container.width-=e.panel["border-x"],this.container.height-=e.panel["border-y"],this._sprite=this.container.displayGroup.add(this.container.root.getRenderer("panel").render(n,s)),this._sprite.x=t,this._sprite.y=i,this._sprite.fixedToCamera=!0,this._offsetX=t,this._offsetY=i},SlickUI.Element.Panel.prototype.add=function(e){return this.container.add(e)},SlickUI.Element.Panel.prototype.remove=function(e){this.container.remove(e)},SlickUI.Element.Panel.prototype.destroy=function(){this.container.displayGroup.removeAll(!0),this.container.displayGroup.destroy(),this.container.children=[],this.container=void 0,this.sprite=void 0},Object.defineProperty(SlickUI.Element.Panel.prototype,"x",{get:function(){return this._x-this.container.parent.x},set:function(e){this._x=e,this.container.displayGroup.x=this.container.parent.x+e-this._offsetX}}),Object.defineProperty(SlickUI.Element.Panel.prototype,"y",{get:function(){return this._y-this.container.parent.y},set:function(e){this._y=e,this.container.displayGroup.y=this.container.parent.y+e-this._offsetY}}),Object.defineProperty(SlickUI.Element.Panel.prototype,"visible",{get:function(){return this.container.displayGroup.visible},set:function(e){this.container.displayGroup.visible=e}}),Object.defineProperty(SlickUI.Element.Panel.prototype,"alpha",{get:function(){return this.container.displayGroup.alpha},set:function(e){this.container.displayGroup.alpha=e}}),Object.defineProperty(SlickUI.Element.Panel.prototype,"width",{get:function(){return this.container.width},set:function(e){var t=this.container.root.game.cache.getJSON("slick-ui-theme");this._width=Math.round(e+t.panel["border-x"]),this._sprite.destroy(),this.init(),this.container.displayGroup.sendToBack(this._sprite)}}),Object.defineProperty(SlickUI.Element.Panel.prototype,"height",{get:function(){return this.container.height},set:function(e){var t=this.container.root.game.cache.getJSON("slick-ui-theme");this._height=Math.round(e+t.panel["border-y"]),this._sprite.destroy(),this.init(),this.container.displayGroup.sendToBack(this._sprite)}}),SlickUI.namespace("Element.Renderer"),SlickUI.Element.Renderer.ButtonRenderer=function(e){this.game=e},SlickUI.Element.Renderer.ButtonRenderer.prototype.render=function(e,t){var i=this.game.cache.getJSON("slick-ui-theme"),n=this,s=function(s){var r=n.game.add.bitmapData(e,t);return r.copyRect(s,new Phaser.Rectangle(0,0,i.button["border-x"],i.button["border-y"])),r.copy(s,i.button["border-x"]+1,0,1,i.button["border-y"],i.button["border-x"],0,e-2*i.button["border-x"],i.button["border-y"]),r.copyRect(s,new Phaser.Rectangle(s.width-i.button["border-x"],0,i.button["border-x"],i.button["border-y"]),e-i.button["border-x"]),r.copy(s,0,i.button["border-y"]+1,i.button["border-x"],1,0,i.button["border-y"],i.button["border-x"],t-2*i.button["border-y"]),r.copy(s,s.width-i.button["border-x"],i.button["border-y"]+1,i.button["border-x"],1,e-i.button["border-x"],i.button["border-y"],i.button["border-x"],t-2*i.button["border-y"]),r.copyRect(s,new Phaser.Rectangle(0,s.height-i.button["border-y"],i.button["border-x"],i.button["border-y"]),0,t-i.button["border-y"]),r.copyRect(s,new Phaser.Rectangle(s.width-i.button["border-x"],s.height-i.button["border-y"],i.button["border-x"],i.button["border-y"]),e-i.button["border-x"],t-i.button["border-y"]),r.copy(s,i.button["border-x"]+1,s.height-i.button["border-y"],1,i.button["border-y"],i.button["border-x"],t-i.button["border-y"],e-2*i.button["border-x"],i.button["border-y"]),r.copy(s,i.button["border-x"],i.button["border-y"],1,1,i.button["border-x"],i.button["border-y"],e-2*i.button["border-x"],t-2*i.button["border-y"]),n.game.make.sprite(0,0,r)};return[s(this.game.make.sprite(0,0,"slick-ui-button_off")),s(this.game.make.sprite(0,0,"slick-ui-button_on"))]},SlickUI.namespace("Element.Renderer"),SlickUI.Element.Renderer.CheckboxRenderer=function(e){this.game=e},SlickUI.Element.Renderer.CheckboxRenderer.prototype.render=function(e){return[this.game.make.sprite(0,0,"slick-ui-"+e+"_off"),this.game.make.sprite(0,0,"slick-ui-"+e+"_on")]},SlickUI.namespace("Element.Renderer"),SlickUI.Element.Renderer.KeyboardRenderer=function(e){this.game=e},SlickUI.Element.Renderer.KeyboardRenderer.prototype.render=function(e){var t=this.game.make.bitmapData(this.game.width,e);return t.ctx.beginPath(),t.ctx.rect(0,0,this.game.width,e),t.ctx.fillStyle="#cccccc",t.ctx.fill(),t.ctx.beginPath(),t.ctx.rect(0,2,this.game.width,e-2),t.ctx.fillStyle="#f0f0f0",t.ctx.fill(),this.game.make.sprite(0,0,t)},SlickUI.namespace("Element.Renderer"),SlickUI.Element.Renderer.KeyRenderer=function(e){this.game=e},SlickUI.Element.Renderer.KeyRenderer.prototype.render=function(e,t){var i=this.game.make.graphics(0,0);i.beginFill(13619151),i.drawRoundedRect(0,0,e,t,5),i.beginFill(16777215),i.drawRoundedRect(1,1,e-2,t-2,5);var n=this.game.make.graphics(0,0);return n.beginFill(1542840),n.drawRoundedRect(0,0,e,t,5),n.beginFill(2074593),n.drawRoundedRect(1,1,e-2,t-2,5),[this.game.make.sprite(0,0,i.generateTexture()),this.game.make.sprite(0,0,n.generateTexture())]},SlickUI.namespace("Element.Renderer"),SlickUI.Element.Renderer.PanelRenderer=function(e){this.game=e},SlickUI.Element.Renderer.PanelRenderer.prototype.render=function(e,t){var i=this.game.cache.getJSON("slick-ui-theme"),n=this.game.add.bitmapData(this.game.width,this.game.height),s=this.game.make.sprite(0,0,"slick-ui-panel");return n.copyRect(s,new Phaser.Rectangle(0,0,i.panel["border-x"],i.panel["border-y"])),n.copy(s,i.panel["border-x"]+1,0,1,i.panel["border-y"],i.panel["border-x"],0,e-2*i.panel["border-x"],i.panel["border-y"]),n.copyRect(s,new Phaser.Rectangle(s.width-i.panel["border-x"],0,i.panel["border-x"],i.panel["border-y"]),e-i.panel["border-x"]),n.copy(s,0,i.panel["border-y"]+1,i.panel["border-x"],1,0,i.panel["border-y"],i.panel["border-x"],t-2*i.panel["border-y"]),n.copy(s,s.width-i.panel["border-x"],i.panel["border-y"]+1,i.panel["border-x"],1,e-i.panel["border-x"],i.panel["border-y"],i.panel["border-x"],t-2*i.panel["border-y"]),n.copyRect(s,new Phaser.Rectangle(0,s.height-i.panel["border-y"],i.panel["border-x"],i.panel["border-y"]),0,t-i.panel["border-y"]),n.copyRect(s,new Phaser.Rectangle(s.width-i.panel["border-x"],s.height-i.panel["border-y"],i.panel["border-x"],i.panel["border-y"]),e-i.panel["border-x"],t-i.panel["border-y"]),n.copy(s,i.panel["border-x"]+1,s.height-i.panel["border-y"],1,i.panel["border-y"],i.panel["border-x"],t-i.panel["border-y"],e-2*i.panel["border-x"],i.panel["border-y"]),n.copy(s,i.panel["border-x"],i.panel["border-y"],1,1,i.panel["border-x"],i.panel["border-y"],e-2*i.panel["border-x"],t-2*i.panel["border-y"]),this.game.make.sprite(0,0,n)},SlickUI.namespace("Element.Renderer"),SlickUI.Element.Renderer.SliderRenderer=function(e){this.game=e},SlickUI.Element.Renderer.SliderRenderer.prototype.render=function(e,t){this.game.cache.getJSON("slick-ui-theme");var i=this.game.make.sprite(0,0,"slick-ui-slider_base"),n=this.game.make.sprite(0,0,"slick-ui-slider_end"),s=this.game.add.bitmapData(e,n.height);s.copy(i,0,0,1,i.height,0,Math.round(n.height/4),e,i.height),s.copy(n,0,0,n.width,n.height,0,0,n.width,n.height),s.copy(n,0,0,n.width,n.height,e-n.width,0,n.width,n.height);var r=this.game.make.sprite(0,0,"slick-ui-slider_handle_off"),o=this.game.make.sprite(0,0,"slick-ui-slider_handle_on");return i=this.game.make.sprite(0,0,s),t&&(i.angle=90),[i,r,o]},SlickUI.namespace("Element.Renderer"),SlickUI.Element.Renderer.TextFieldRenderer=function(e){this.game=e},SlickUI.Element.Renderer.TextFieldRenderer.prototype.render=function(e,t){var i=this.game.cache.getJSON("slick-ui-theme"),n=this.game.add.bitmapData(e,t),s=this.game.make.sprite(0,0,"slick-ui-text_field");return n.copyRect(s,new Phaser.Rectangle(0,0,i.text_field["border-x"],i.text_field["border-y"])),n.copy(s,i.text_field["border-x"]+1,0,1,i.text_field["border-y"],i.text_field["border-x"],0,e-2*i.text_field["border-x"],i.text_field["border-y"]),n.copyRect(s,new Phaser.Rectangle(s.width-i.text_field["border-x"],0,i.text_field["border-x"],i.text_field["border-y"]),e-i.text_field["border-x"]),n.copy(s,0,i.text_field["border-y"]+1,i.text_field["border-x"],1,0,i.text_field["border-y"],i.text_field["border-x"],t-2*i.text_field["border-y"]),n.copy(s,s.width-i.text_field["border-x"],i.text_field["border-y"]+1,i.text_field["border-x"],1,e-i.text_field["border-x"],i.text_field["border-y"],i.text_field["border-x"],t-2*i.text_field["border-y"]),n.copyRect(s,new Phaser.Rectangle(0,s.height-i.text_field["border-y"],i.text_field["border-x"],i.text_field["border-y"]),0,t-i.text_field["border-y"]),n.copyRect(s,new Phaser.Rectangle(s.width-i.text_field["border-x"],s.height-i.text_field["border-y"],i.text_field["border-x"],i.text_field["border-y"]),e-i.text_field["border-x"],t-i.text_field["border-y"]),n.copy(s,i.text_field["border-x"]+1,s.height-i.text_field["border-y"],1,i.text_field["border-y"],i.text_field["border-x"],t-i.text_field["border-y"],e-2*i.text_field["border-x"],i.text_field["border-y"]),n.copy(s,i.text_field["border-x"],i.text_field["border-y"],1,1,i.text_field["border-x"],i.text_field["border-y"],e-2*i.text_field["border-x"],t-2*i.text_field["border-y"]),this.game.make.sprite(0,0,n)},SlickUI.namespace("Element"),SlickUI.Element.Slider=function(e,t,i,n,s){this._x=e,this._y=t,this._size=i,this._value=n,this._vertical=!0===s,this.container=null,void 0===n&&(this._value=1),this._vertical&&(this._value=Math.abs(this._value-1))},SlickUI.Element.Slider.prototype.setContainer=function(e){this.container=e},SlickUI.Element.Slider.prototype.unsetContainer=function(){this.container.removeParent()},SlickUI.Element.Slider.prototype.init=function(){this.container.root.game.cache.getJSON("slick-ui-theme");this.onDragStart=new Phaser.Signal,this.onDrag=new Phaser.Signal,this.onDragStop=new Phaser.Signal,this.displayGroup=game.add.group();var e=this.container.x+this._x,t=this.container.y+this._y,i=this._vertical?t:e,n=this._vertical?"y":"x",s=Math.min(this.container.width-this._x,this._size);this._vertical&&(s=Math.min(this.container.height-this._y,this._size));var r=Math.min(1,Math.max(0,this._value))*s+i,o=this.container.root.getRenderer("slider").render(s,this._vertical),a=o[0],h=o[1],d=o[2];a.x=e,a.y=t;var l=this.container.root.game.make.sprite(this._vertical?e:r,this._vertical?r:t,h.texture);l.anchor.setTo(.5),this._vertical&&(l.angle=270),a.fixedToCamera=!0,l.fixedToCamera=!0,l.inputEnabled=!0,l.input.useHandCursor=!0;var c=!1,p=function(){var e=(l.cameraOffset[n]-i)/s;return this._vertical&&(e=Math.abs(e-1)),e};l.events.onInputDown.add(function(){l.loadTexture(d.texture),c=!0,this.onDragStart.dispatch(p.apply(this))},this),l.events.onInputUp.add(function(){l.loadTexture(h.texture),c=!1,this.onDragStop.dispatch(p.apply(this))},this),this.container.root.game.input.addMoveCallback(function(e,t,r){if(c){var o=(this._vertical?r:t)-this.displayGroup[n];l.cameraOffset[n]=Math.min(i+s,Math.max(i,o-this.container.displayGroup[n])),this.onDrag.dispatch(p.apply(this))}},this),this.displayGroup.add(a),this.displayGroup.add(l),this.container.displayGroup.add(this.displayGroup)},SlickUI.Element.Slider.prototype.destroy=function(){this.container.destroy()},Object.defineProperty(SlickUI.Element.Slider.prototype,"x",{get:function(){return this.displayGroup.x+this._x},set:function(e){this.displayGroup.x=e-this._x}}),Object.defineProperty(SlickUI.Element.Slider.prototype,"y",{get:function(){return this.displayGroup.y+this._y},set:function(e){this.displayGroup.y=e-this._y}}),Object.defineProperty(SlickUI.Element.Slider.prototype,"alpha",{get:function(){return this.displayGroup.alpha},set:function(e){this.displayGroup.alpha=e}}),Object.defineProperty(SlickUI.Element.Slider.prototype,"visible",{get:function(){return this.displayGroup.visible},set:function(e){this.displayGroup.visible=e}}),SlickUI.namespace("Element"),SlickUI.Element.Text=function(e,t,i,n,s,r,o,a){this._x=e,this._y=t,this._value=i,this.width=o,this.height=a,this.font=r,this.size=n,this.fill=s,this.container=null},SlickUI.Element.Text.prototype.setContainer=function(e){this.container=e,void 0===this.width&&(this.width=this.container.root.game.width),void 0===this.height&&(this.height=this.container.root.game.height),void 0===this.size&&(this.size=20)},SlickUI.Element.Text.prototype.unsetContainer=function(){this.container.removeParent()},SlickUI.Element.Text.prototype.reset=function(e,t,i){var n;n=Math.min(this.container.width-e,this.width),Math.min(this.container.height-t,this.height),void 0!==this.text&&(!1===i&&(n=this.text.wordWrapWidth),this.text.destroy()),e+=this.container.x,t+=this.container.y;var s={font:this.font,fontSize:this.size,fill:this.fill};this.text=this.container.root.game.make.text(e,t,this._value,s),this.text.wordWrap=!0,this.text.wordWrapWidth=n,this.container.displayGroup.add(this.text),this.text.fixedToCamera=!0},SlickUI.Element.Text.prototype.init=function(){this.container.root.game.cache.getJSON("slick-ui-theme");void 0===this.font&&(this.font="Lato"),void 0===this.fill&&(this.fill=0),this.reset(this._x,this._y)},SlickUI.Element.Text.prototype.centerHorizontally=function(){return this.text.cameraOffset.x=this.text.wordWrapWidth/2-this.text.width/2+this.container.x,this},SlickUI.Element.Text.prototype.centerVertically=function(){this.container.root.game.cache.getJSON("slick-ui-theme");return this.text.cameraOffset.y=this.container.height/2-this.text.height/2+this.container.y,this},SlickUI.Element.Text.prototype.center=function(){return this.centerHorizontally(),this.centerVertically(),this},SlickUI.Element.Text.prototype.destroy=function(){this.container.destroy()},Object.defineProperty(SlickUI.Element.Text.prototype,"x",{get:function(){return this.text.cameraOffset.x-this.container.x},set:function(e){this.text.cameraOffset.x=e+this.container.x}}),Object.defineProperty(SlickUI.Element.Text.prototype,"y",{get:function(){return this.text.cameraOffset.y-this.container.y},set:function(e){this.text.cameraOffset.y=e+this.container.y}}),Object.defineProperty(SlickUI.Element.Text.prototype,"alpha",{get:function(){return this.text.alpha},set:function(e){this.text.alpha=e}}),Object.defineProperty(SlickUI.Element.Text.prototype,"visible",{get:function(){return this.text.visible},set:function(e){this.text.visible=e}}),Object.defineProperty(SlickUI.Element.Text.prototype,"value",{get:function(){return this.text.text},set:function(e){this.text.text=e}}),SlickUI.namespace("Element"),SlickUI.Element.TextField=function(e,t,i,n,s){void 0===s&&(s=7),this._x=e,this._y=t,this._offsetX=e,this._offsetY=t,this._width=i,this._height=n,this.maxChars=s,this.container=null,this.value="",this.events={onOK:new Phaser.Signal,onToggle:new Phaser.Signal,onKeyPress:new Phaser.Signal}},SlickUI.Element.TextField.prototype.setContainer=function(e){this.container=new SlickUI.Container.Container(e)},SlickUI.Element.TextField.prototype.unsetContainer=function(){this.container.removeParent()},SlickUI.Element.TextField.prototype.init=function(){var e=this.container.root.game.cache.getJSON("slick-ui-theme"),t=this.container.x=this.container.parent.x+this._x,i=this.container.y=this.container.parent.y+this._y,n=this.container.width=Math.min(this.container.parent.width-this._x,this._width),s=this.container.height=Math.min(this.container.parent.height-this._y,this._height);this.container.x+=Math.round(e.text_field["border-x"]/2),this.container.y+=Math.round(e.text_field["border-y"]/2),this.container.width-=e.text_field["border-x"],this.container.height-=e.text_field["border-y"],this.sprite=this.container.root.game.make.sprite(t,i,this.container.root.getRenderer("text_field").render(n,s).texture),this.sprite.inputEnabled=!0,this.sprite.input.useHandCursor=!0,this.container.displayGroup.add(this.sprite),this.sprite.x=t,this.sprite.y=i,this._offsetX=t,this._offsetY=i,this.sprite.fixedToCamera=!0;this.sprite.events.onInputOver.add(function(){!0},this),this.sprite.events.onInputOut.add(function(){!1},this);var r=new SlickUI.Keyboard.Keyboard(this.container.root,Object.keys(e.fonts)[Object.keys(e.fonts).length-1]);r.group.cameraOffset.y=this.container.root.game.height,r.group.visible=!1;var o=!1;this.sprite.events.onInputDown.add(function(){o||(o=!0,r.group.visible?(this.container.root.game.add.tween(r.group.cameraOffset).to({y:this.container.root.game.height},500,Phaser.Easing.Exponential.Out,!0).onComplete.add(function(){o=!1,r.group.visible=!1}),this.events.onToggle.dispatch(!1)):(r.group.visible=!0,this.container.root.game.add.tween(r.group.cameraOffset).to({y:this.container.root.game.height-r.height},500,Phaser.Easing.Exponential.Out,!0).onComplete.add(function(){o=!1}),this.events.onToggle.dispatch(!0)))},this),this.text=this.add(new SlickUI.Element.Text(8,0,"A")),this.text.centerVertically(),this.text.text.text=this.value,r.events.onKeyPress.add(function(e){this.value="DEL"==e?this.value.substr(0,this.value.length-1):(this.value+e).substr(0,this.maxChars),this.text.text.text=this.value,this.events.onKeyPress.dispatch(e)},this),r.events.onOK.add(function(){this.sprite.events.onInputDown.dispatch(),this.events.onOK.dispatch()},this)},SlickUI.Element.TextField.prototype.add=function(e){return this.container.add(e)},SlickUI.Element.TextField.prototype.destroy=function(){this.container.destroy()},Object.defineProperty(SlickUI.Element.TextField.prototype,"x",{get:function(){return this._x-this.container.parent.x},set:function(e){this._x=e,this.container.displayGroup.x=this.container.parent.x+e-this._offsetX}}),Object.defineProperty(SlickUI.Element.TextField.prototype,"y",{get:function(){return this._y-this.container.parent.y},set:function(e){this._y=e,this.container.displayGroup.y=this.container.parent.y+e-this._offsetY}}),Object.defineProperty(SlickUI.Element.TextField.prototype,"visible",{get:function(){return this.container.displayGroup.visible},set:function(e){this.container.displayGroup.visible=e}}),Object.defineProperty(SlickUI.Element.TextField.prototype,"alpha",{get:function(){return this.container.displayGroup.alpha},set:function(e){this.container.displayGroup.alpha=e}}),Object.defineProperty(SlickUI.Element.TextField.prototype,"width",{get:function(){return this.container.width},set:function(e){var t=this.container.root.game.cache.getJSON("slick-ui-theme");this._width=Math.round(e+t.text_field["border-x"]),this.sprite.destroy(),this.init(),this.container.displayGroup.sendToBack(this.sprite)}}),Object.defineProperty(SlickUI.Element.TextField.prototype,"height",{get:function(){return this.container.height},set:function(e){var t=this.container.root.game.cache.getJSON("slick-ui-theme");this._height=Math.round(e+t.text_field["border-y"]),this.sprite.destroy(),this.init(),this.container.displayGroup.sendToBack(this.sprite)}}),SlickUI.namespace("Keyboard"),SlickUI.Keyboard.Key=function(e,t,i,n,s,r,o,a){this.group=e.game.add.group(),this.font=r,this._x=t,this._y=i,this.plugin=e,this._width=n,this._height=s,this.fontSize=o,this.text=a},SlickUI.Keyboard.Key.prototype.init=function(){var e=this.plugin.getRenderer("key").render(this._width,this._height),t=e[0],i=e[1],n=this.plugin.game.make.sprite(this._x,this._y,t.texture),s=!1;n.inputEnabled=!0,n.input.useHandCursor=!0,n.events.onInputDown.add(function(){n.loadTexture(i.texture)}),n.events.onInputUp.add(function(){n.loadTexture(t.texture),s||n.events.onInputUp.halt()}),n.events.onInputOver.add(function(){s=!0},this),n.events.onInputOut.add(function(){s=!1},this);var r=this.plugin.game.make.bitmapText(this._x,this._y,this.font,this.text,this.fontSize);r.x+=this._width/2-r.width/2,r.y+=this._height/2-this.fontSize/2-4,this.group.add(n),this.group.add(r),this.events=n.events},SlickUI.namespace("Keyboard"),SlickUI.Keyboard.Keyboard=function(e,t,i,n){this.group=e.game.add.group(),this.keyGroupLower=e.game.make.group(),this.keyGroupUpper=e.game.make.group(),this.keyGroupCurrent=this.keyGroupLower,this.keyGroupUpper.visible=!1,this.group.fixedToCamera=!0,this.font=t,this.plugin=e,this.fontSize=i,this.height=160,this.events={onKeyPress:new Phaser.Signal,onOK:new Phaser.Signal},void 0===i&&(this.fontSize=16),!1!==n&&this.create()},SlickUI.Keyboard.Keyboard.prototype.create=function(){var e=this.plugin.getRenderer("keyboard").render(this.height);this.group.add(e),this.group.add(this.keyGroupLower),this.group.add(this.keyGroupUpper);var t=Math.round(this.plugin.game.width/2-220);this.addKey(new SlickUI.Keyboard.Key(this.plugin,t,16,32,32,this.font,this.fontSize,"1"),this.group),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+36,16,32,32,this.font,this.fontSize,"2"),this.group),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+72,16,32,32,this.font,this.fontSize,"3"),this.group),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+108,16,32,32,this.font,this.fontSize,"4"),this.group),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+144,16,32,32,this.font,this.fontSize,"5"),this.group),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+180,16,32,32,this.font,this.fontSize,"6"),this.group),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+216,16,32,32,this.font,this.fontSize,"7"),this.group),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+252,16,32,32,this.font,this.fontSize,"8"),this.group),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+288,16,32,32,this.font,this.fontSize,"9"),this.group),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+324,16,32,32,this.font,this.fontSize,"0"),this.group),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+360,16,64,32,this.font,this.fontSize,"DEL"),this.group),t+=16,this.addKey(new SlickUI.Keyboard.Key(this.plugin,t,52,32,32,this.font,this.fontSize,"q")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+36,52,32,32,this.font,this.fontSize,"w")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+72,52,32,32,this.font,this.fontSize,"e")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+108,52,32,32,this.font,this.fontSize,"r")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+144,52,32,32,this.font,this.fontSize,"t")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+180,52,32,32,this.font,this.fontSize,"y")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+216,52,32,32,this.font,this.fontSize,"u")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+252,52,32,32,this.font,this.fontSize,"i")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+288,52,32,32,this.font,this.fontSize,"o")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+324,52,32,32,this.font,this.fontSize,"p")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+360,52,32,32,this.font,this.fontSize,"!"),this.group),t+=16,this.addKey(new SlickUI.Keyboard.Key(this.plugin,t,88,32,32,this.font,this.fontSize,"a")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+36,88,32,32,this.font,this.fontSize,"s")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+72,88,32,32,this.font,this.fontSize,"d")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+108,88,32,32,this.font,this.fontSize,"f")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+144,88,32,32,this.font,this.fontSize,"g")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+180,88,32,32,this.font,this.fontSize,"h")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+216,88,32,32,this.font,this.fontSize,"j")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+252,88,32,32,this.font,this.fontSize,"k")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+288,88,32,32,this.font,this.fontSize,"l")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+324,88,80,32,this.font,this.fontSize,"UPPER")),t+=16,this.addKey(new SlickUI.Keyboard.Key(this.plugin,t-40,124,36,32,this.font,this.fontSize,"OK"),this.group),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t,124,32,32,this.font,this.fontSize,"z")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+36,124,32,32,this.font,this.fontSize,"x")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+72,124,32,32,this.font,this.fontSize,"c")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+108,124,32,32,this.font,this.fontSize,"v")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+144,124,32,32,this.font,this.fontSize,"b")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+180,124,32,32,this.font,this.fontSize,"n")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+216,124,32,32,this.font,this.fontSize,"m")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+252,124,32,32,this.font,this.fontSize,","),this.group),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+288,124,32,32,this.font,this.fontSize,"."),this.group),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+324,124,32,32,this.font,this.fontSize," "),this.group),t-=32,this.keyGroupCurrent=this.keyGroupUpper,this.addKey(new SlickUI.Keyboard.Key(this.plugin,t,52,32,32,this.font,this.fontSize,"Q")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+36,52,32,32,this.font,this.fontSize,"W")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+72,52,32,32,this.font,this.fontSize,"E")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+108,52,32,32,this.font,this.fontSize,"R")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+144,52,32,32,this.font,this.fontSize,"T")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+180,52,32,32,this.font,this.fontSize,"Y")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+216,52,32,32,this.font,this.fontSize,"U")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+252,52,32,32,this.font,this.fontSize,"I")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+288,52,32,32,this.font,this.fontSize,"O")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+324,52,32,32,this.font,this.fontSize,"P")),t+=16,this.addKey(new SlickUI.Keyboard.Key(this.plugin,t,88,32,32,this.font,this.fontSize,"A")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+36,88,32,32,this.font,this.fontSize,"S")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+72,88,32,32,this.font,this.fontSize,"D")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+108,88,32,32,this.font,this.fontSize,"F")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+144,88,32,32,this.font,this.fontSize,"G")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+180,88,32,32,this.font,this.fontSize,"H")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+216,88,32,32,this.font,this.fontSize,"J")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+252,88,32,32,this.font,this.fontSize,"K")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+288,88,32,32,this.font,this.fontSize,"L")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+324,88,80,32,this.font,this.fontSize,"lower")),t+=16,this.addKey(new SlickUI.Keyboard.Key(this.plugin,t,124,32,32,this.font,this.fontSize,"Z")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+36,124,32,32,this.font,this.fontSize,"X")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+72,124,32,32,this.font,this.fontSize,"C")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+108,124,32,32,this.font,this.fontSize,"V")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+144,124,32,32,this.font,this.fontSize,"B")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+180,124,32,32,this.font,this.fontSize,"N")),this.addKey(new SlickUI.Keyboard.Key(this.plugin,t+216,124,32,32,this.font,this.fontSize,"M"))},SlickUI.Keyboard.Keyboard.prototype.addKey=function(e,t){e.init(),void 0===t&&(t=this.keyGroupCurrent),t.add(e.group),e.events.onInputUp.add(function(){"UPPER"!=e.text&&"lower"!=e.text?"OK"!=e.text?this.events.onKeyPress.dispatch(e.text):this.events.onOK.dispatch():this.toggleMode()},this)},SlickUI.Keyboard.Keyboard.prototype.toggleMode=function(){this.keyGroupUpper.visible=!this.keyGroupUpper.visible,this.keyGroupLower.visible=!this.keyGroupLower.visible};